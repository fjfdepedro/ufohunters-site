var ufo_data=function(){function t(t){p[t]&&n(p[t],function(){r()})}function e(t){p[t]&&n(p[t],function(){h.transition().duration(750).attr("r",function(t){return c(t)+100}).delay(250).style("opacity",function(){return 0}).remove(),r()})}function n(t,e){$.getJSON(t,function(){o=[{_id:{shape:"Flare"},count:1},{_id:{shape:"Crescent"},count:2},{_id:{shape:"Egg"},count:755},{_id:{shape:"Hexagon"},count:1},{_id:{shape:"Rectangle"},count:1178},{_id:{shape:"Round"},count:2},{_id:{shape:"Pyramid"},count:1},{_id:{shape:"Changed"},count:1},{_id:{shape:"Unknown"},count:5420},{_id:{shape:"Diamond"},count:1120},{_id:{shape:"Light"},count:15151},{_id:{shape:"Delta"},count:8},{_id:{shape:"Sphere"},count:4671},{_id:{shape:"Teardrop"},count:720},{_id:{shape:"Cone"},count:319},{_id:{shape:""},count:2745},{_id:{shape:"Cigar"},count:1998},{_id:{shape:"Cross"},count:218},{_id:{shape:"Formation"},count:2223},{_id:{shape:"Fireball"},count:5085},{_id:{shape:"Changing"},count:1854},{_id:{shape:"Flash"},count:1243},{_id:{shape:"Triangle"},count:7292},{_id:{shape:"Chevron"},count:889},{_id:{shape:"Disk"},count:5329},{_id:{shape:"Cylinder"},count:1178},{_id:{shape:"Oval"},count:3529},{_id:{shape:"Dome"},count:1},{_id:{shape:"Circle"},count:6851},{_id:{shape:"Other"},count:5400}],u=o.pop(),o.map(function(t){{var e=parseInt(t.count);parseInt(t.count)}return t.count=e?e:0,t.score=e?e:0,t.time=10*e,d.test(t.url)&&(t.url="http://news.ycombinator.com/"+t.url),t}),c=d3.scale.linear().domain([d3.min(o,function(t){return t.score}),d3.max(o,function(t){return t.score})]).range([10,130]).clamp(!0),l=d3.scale.linear().domain([d3.min(o,function(t){return t.count}),d3.max(o,function(t){return t.count})]).range(["#698DC5","#698DC5"]),s=d3.scale.linear().domain([d3.min(o,function(t){return t.time}),d3.max(o,function(t){return t.time})]).range([.3,1]),f=function(t){return-c(t)*c(t)/2.5},e()})}function r(){function t(t){M.gravity(b).charge(function(t){return f(t.score)}).friction(_).on("tick",function(e){t(e.alpha),n.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}).start()}function e(t){M.nodes().forEach(function(e){e.x=e.x+(y.x-e.x)*(x+.02)*t,e.y=e.y+(y.y-e.y)*(x+.02)*t})}M.nodes(o),h=w.append("g").attr("id","circles").selectAll("a").data(M.nodes()),M.nodes().forEach(function(t){t.x=Math.random()*g,t.y=Math.random()*m});var n=h.enter().append("a").attr("xlink:href",function(t){return t.url}).append("circle").attr("r",0).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("fill",function(t){return l(t.count)}).attr("stroke-width",2).attr("stroke",function(t){return d3.rgb(l(t.count)).darker()}).attr("id",function(t){return"post_#"+t.item_id}).attr("title",function(t){return t.title}).style("opacity",function(t){return s(t.time)}).on("mouseover",function(t,e){M.resume(),i(t,e,this)}).on("mouseout",function(t,e){a(t,e,this)});d3.selectAll("circle").transition().delay(function(t,e){return 10*e}).duration(1e3).attr("r",function(t){return c(t.score)}),t(e)}function i(t,e,n){d3.select(n).attr("stroke","black");var r='<span class="title"><strong>Shape:</strong> "'+t._id.shape+'"</span><br/><span><strong>Number of sightings:</strong> '+t.count+"</span>";E.showTooltip(r,d3.event)}function a(t,e,n){d3.select(n).attr("stroke",function(t){return d3.rgb(l(t.count)).darker()})}var o,u,s,c,l,f,h,p={shape:"http://ufo-hunters-2013.herokuapp.com/stats/shape.json",ask:"http://hndroidapi.appspot.com/ask/format/json/page/?appid=vishna&callback=?",newest:"http://hndroidapi.appspot.com/newest/format/json/page/?appid=vishna&callback=?",best:"http://hndroidapi.appspot.com/best/format/json/page/?appid=vishna&callback=?"},d=/^(item[?]id[=][0-9]+)/,g=Math.max(.85*$(window).width(),960),m=Math.max(.85*$(window).height(),600),v=20,y={x:(g-v)/2,y:(m-v)/2},b=-.01,x=.2,_=.9,M=d3.layout.force().size([g-v,m-v]),w=d3.select("body article").append("svg").attr("height",m+"px").attr("width",g+"px"),E=CustomTooltip("posts_tooltip",240);return $("a.category").on("click",function(){e($(this).attr("value"))}),{categories:["news","best","ask","newest"],init:t,update:e}}();ufo_data.init("newest");